%\NeedsTeXFormat{LaTeX2e}[1999/12/01]
%\ProvidesPackage{kth-layout}
%    [2025/10/09 v0.1 Provides template-specific layout needed for kththesis.cls]

% Set up the header and footer for plain style pages
\fancypagestyle{plain}{%
\fancyhf{}% clear all header and footer fields
\fancyfoot[C]{\pageNumberFont\small\selectfont\thepage}
\renewcommand{\headrulewidth}{0pt}%
\renewcommand{\footrulewidth}{0pt}%
}
% Set up the header and footer
\fancyhead{}
%\fancyhead[RO]{\sffamily\small\leftmark\thinspace|\thinspace\thepage}
%\fancyhead[LE]{\sffamily\small\thepage\thinspace|\thinspace\leftmark}
% Without conversion to uppercase
% Note that we need to switch to the familydefault for the page numbers
\fancyhead[RO]{{\sffamily\small\nouppercase\leftmark\thinspace|\thinspace}{\pageNumberFont\small\selectfont\thepage}}
\fancyhead[LE]{{\pageNumberFont\small\selectfont\thepage}{\sffamily\small\thinspace|\thinspace\nouppercase\leftmark}}
\fancyfoot{}
\renewcommand{\headrulewidth}{0pt}
\pagestyle{fancy}


% Add 5% extra linespacing
\linespread{1.05}

% Set the proper format for the headers
\titleformat{\chapter}[display]
  {\normalfont\sffamily\huge\bfseries}
  {\chaptertitlename\ \thechapter}{20pt}{\Huge}
\titleformat{\section}
  {\normalfont\sffamily\Large\bfseries}
  {\thesection}{1em}{}
\titleformat{\subsection}
  {\normalfont\sffamily\large\bfseries}
  {\thesubsection}{1em}{}
\titleformat{\subsubsection}
  {\normalfont\sffamily\normalsize\bfseries}
  {\thesubsubsection}{1em}{}

\renewenvironment{abstract}{\section*{\abstractname}}


\newcommand{\keywordHeading}[1]{\subsection*{#1}}

% Turn off autodot - although it might be used at the end of headings in Russian
\newcommand{\autodot}{}

\makeatletter
% For information about the page layout see https://www.overleaf.com/learn/latex/Page_size_and_margins
\newcommand{\kthcover}{
% Note that the values have only been adjusted for A4 paper!
\iftoggle{gfivepaper}{
  \newgeometry{top=65mm,bottom=30mm,left=62mm,right=18mm}
}{
  \newgeometry{top=232.34pt,bottom=70.9pt,left=70.9pt, right=70.9pt} % formerly {top=56mm,bottom=30mm,left=74pt, right=35mm}
}

\thispagestyle{empty}



\begin{textblock*}{106.16898110pt}(226.77pt, 35.4pt) % formerly 20pt, 40pt
\includegraphics[width=106.16898110pt, height=118.9419140pt, keepaspectratio]{KTH_logo_RGB_bla.png}
\end{textblock*}
%\vspace{160pt}
\begin{center}
% look for a second subject
\ifx\@secondSubjectArea\@empty

  \ifinswedish
  {\fontsize{12}{13} \coverlfont 
  Examensarbete inom \@subjectArea\\
  }
  \addvspace{8pt}
    {\fontsize{10}{12}  \coverlfont
  \IfEqCase{\@courseCycle}{%
    {XXX}{\textcolor{red}{*****Okänd cykel*****,}}%
    {1}{Grundnivå,}%
    {2}{Avancerad nivå,}%
  }[\typeout{unknown cycle}]
~\IfEqCase{\@courseCredits}{%
    {XXX}{\textcolor{red}{*****Okänt antal *****}}%
    {5.0}{5}%
    {7.5}{7,5}%
    {10.0}{10}%
    {12.0}{12}%
    {14.0}{14}%
    {15.0}{15}%
    {16.0}{16}%
    {18.0}{18}%
    {20.0}{20}%
    {22.5}{22,5}%
    {28.0}{28}%
    {30.0}{30}%
    {35.0}{33}%
    {37.5}{37,5}%
    {45.0}{45}%
    {60.0}{60}%
    {90.0}{90}%
    {120.0}{120}%
    {180.0}{180}%
    {210.0}{210}%
    {240.0}{240}%
    {300.0}{300}%
    {330.0}{330}%
    }[\typeout{unknown credits}]%
~hp\\
    }
  \else
{\coverlfont \fontsize{12}{13}
  Degree Project in \@subjectArea\\
}
  \addvspace{8pt}
  {\fontsize{10}{12} \coverlfont 
  \IfEqCase{\@courseCycle}{%
    {XXX}{\textcolor{red}{*****Unknown cycle*****,}}
    {1}{First cycle,}%
    {2}{Second cycle,}%
  }[\typeout{unknown cycle}]
\,\IfEqCase{\@courseCredits}{%
    {XXX}{\textcolor{red}{*****Unknown number of *****}}%
    {5.0}{5}%
    {7.5}{7.5}%
    {10.0}{10}%
    {12.0}{12}%
    {14.0}{14}%
    {15.0}{15}%
    {16.0}{16}%
    {18.0}{18}%
    {20.0}{20}%
    {22.5}{22.5}%
    {28.0}{28}%
    {30.0}{30}%
    {35.0}{33}%
    {37.5}{37.5}%
    {45.0}{45}%
    {60.0}{60}%
    {90.0}{90}%
    {120.0}{120}%
    {180.0}{180}%
    {210.0}{210}%
    {240.0}{240}%
    {300.0}{300}%
    {330.0}{330}%
    }[\typeout{unknown credits}]%
~credits\\
  }
  \fi
    
\else
  \ifinswedish
  {\fontsize{12}{13} \coverlfont 
      \ifthenelse{\equal{\@subjectArea}{\@secondSubjectArea}}
    {Examensarbete inom teknikområdet och huvudområdet \@subjectArea\\}
    {Examensarbete inom teknikområdet \@subjectArea\ och huvudområdet \@secondSubjectArea\\}%
  }
%  \IfEqCase{\@degreeName}{%
%    {Both}{Examensarbete inom teknikområdet \@subjectArea\ och huvudområdet \@secondSubjectArea\\}%
%    {Same}{Examensarbete inom teknikområdet och huvudområdet \@subjectArea\\}%
%  }[\typeout{unknown degree name in case for both Masters degrees}]
  \addvspace{8pt}
   {\fontsize{10}{12} \coverlfont
  \IfEqCase{\@courseCycle}{%
    {XXX}{\textcolor{red}{*****Okänd cykel*****,}}%
    {1}{Grundnivå,}%
    {2}{Avancerad nivå,}%
  }[\typeout{unknown cycle}]
~\IfEqCase{\@courseCredits}{%
    {XXX}{\textcolor{red}{*****Okänt antal *****}}%
    {15.0}{15}%
    {30.0}{30}%
    }[\typeout{unknown credits}]%
~hp\\
    }
  \else
  {\fontsize{12}{13} \coverlfont
  \ifthenelse{\equal{\@subjectArea}{\@secondSubjectArea}}
    {Degree Project in the Field of Technology and the Main Field of Study \@subjectArea\\}
    {Degree Project in the Field of Technology \@subjectArea\ and the Main Field of Study \@secondSubjectArea\\}%
  }
%    \IfEqCase{\@degreeName}{%
%    {Both}{Degree Project in the Field of Technology \@subjectArea\ and the Main Field of Study \@secondSubjectArea\\}%
%    {Same}{Degree Project in the Field of Technology and the Main Field of Study \@subjectArea\\}%
%  }[\typeout{unknown degree name in case for both Masters degrees}]
  
  \addvspace{8pt}
  {\fontsize{10}{12} \coverlfont
  \IfEqCase{\@courseCycle}{%
    {XXX}{\textcolor{red}{*****Unknown cycle*****,}}%
    {1}{First cycle,}%
    {2}{Second cycle,}%
  }[\typeout{unknown cycle}]
\,\IfEqCase{\@courseCredits}{%
    {XXX}{\textcolor{red}{*****Unknown number of *****}}%
    {15.0}{15}%
    {30.0}{30}%
    }[\typeout{unknown credits}]%
~credits\\
  }
  \fi


\fi
\addvspace{28pt}
{\fontsize{26}{30}\coverbfont \@title \par }


\ifx\@subtitle\@empty\relax
\else
\addvspace{12pt}
    {\fontsize{16}{18}\coverlfont  \@subtitle \par }
\fi

\addvspace{30pt}
    {\fontsize{12}{13}\coverbfont
    \expandafter\MakeUppercase\expandafter\@authorsFirstname\space\expandafter\MakeUppercase\expandafter\@authorsLastname \par
    \ifx\@secondAuthorsLastname\@empty\relax
    \else\addvspace{2pt}\expandafter\MakeUppercase\expandafter\@secondAuthorsFirstname\space\expandafter\MakeUppercase\expandafter\@secondAuthorsLastname \par
    \fi
    }
\end{center}
% Include a cover picture if one is specified
% Note that the author may need to adjust the height and width to get exacty what they want.
\vfill
\ifx\@coverIllustration\@empty\relax
\else
\addvspace{1cm}
    \begin{center}
    \IfFileExists{\@coverIllustration}{
\noindent\includegraphics[width=16cm, height=10cm, keepaspectratio]{\@coverIllustration}
    }{}
    \end{center}
\fi
\restoregeometry
\clearpage
}

\newcommand{\kthbackcover}{
% Note that the values have only been adjusted for A4 paper!
\iftoggle{gfivepaper}{
  \newgeometry{top=65mm,bottom=30mm,left=62mm,right=18mm}
}{
  \newgeometry{top=65mm,bottom=30mm,left=74pt, right=35mm}
}

\thispagestyle{empty}

% Generate the back cover with the TRITA number and the fixed graphical elements
\begin{textblock*}{5cm}(38.83pt, {\paperheight - 101pt}) % {block width} (coords) 
\noindent{\fontsize{10}{12}\coverlfont 
    \ifx\@thesisSeries\@empty %\relax
        TRITA xxxx:yyy
        \else
        	\@thesisSeries\,\ifx\@thesisSeriesNumber\@empty\relax
            \else
            \@thesisSeriesNumber
             \fi
    \fi\\
}
\end{textblock*}
\begin{textblock*}{510pt}(38.83pt, {\paperheight - 90pt}) % {block width} (coords) 
\ifinswedish
\noindent{\fontsize{8}{10}\coverlfont Stockholm, Sverige \the\year{}}\\
  \else
\noindent{\fontsize{8}{10}\coverlfont Stockholm, Sweden \the\year{}}\\
  \fi
\end{textblock*}
\begin{textblock*}{5cm}(38.83pt, {\paperheight - 63pt}) % {block width} (coords)  - was 44pt
\noindent{\fontsize{8}{9}\coverlfont
    \textcolor{kth-blue}{www.kth.se}
}
\end{textblock*}

\restoregeometry
\null\newpage
}

% Command to print out the standardized title page
\renewcommand{\titlepage}{
\iftoggle{gfivepaper}{
  \newgeometry{top=65mm,bottom=30mm,left=62mm,right=18mm}
}{
  \newgeometry{top=65mm,bottom=30mm,left=74pt,right=35mm} % formerly left=50mm
}

\thispagestyle{empty}

\ifinswedish\selectlanguage{swedish}\fi

\begin{huge}
  \begin{flushleft}
    \noindent\sffamily\bfseries \@title \par
  \end{flushleft}
\end{huge}

\ifx\@subtitle\@empty\relax
\else
\begin{Large}
  \vspace{1ex}
  \begin{flushleft}
    \noindent\sffamily\bfseries \@subtitle \par
  \end{flushleft}
\end{Large}
\fi


\vspace{10mm}
\begin{large}
  \begin{flushleft}
    \sffamily
    \expandafter\MakeUppercase\expandafter\@authorsFirstname\space\expandafter\MakeUppercase\expandafter\@authorsLastname \par
    \ifx\@secondAuthorsLastname\@empty\relax
    \else\vspace{1ex}\expandafter\MakeUppercase\expandafter\@secondAuthorsFirstname\space\expandafter\MakeUppercase\expandafter\@secondAuthorsLastname \par
    \fi
  \end{flushleft}
\end{large}

\vfill

\begin{flushleft}
  \sffamily
  \ifinswedish
%    \programmecode{\@programcode}\par
%    \ifx\@secondProgramcode och \programmecode{\@secondProgramcode} \par \fi  % for a second program
    \@prgmcode\par
    \ifx\@prgmcode och \@secondprgmcode \par  \fi   % for a second program
    \ifx\@date\@empty\relax\else Datum: \@date\\ \vspace{5mm} \fi
    Handledare: \@supervisorAsFirstname\space\@supervisorAsLastname
    \ifx\@supervisorBsLastname\@empty
    \else
    , \@supervisorBsFirstname\space\@supervisorBsLastname
    \fi % end of if B
    \ifx\@supervisorCsLastname\@empty
    \else
    , \@supervisorCsFirstname\space\@supervisorCsLastname
    \fi % end of if C
    \ifx\@supervisorDsLastname\@empty
    \else
    , \@supervisorDsFirstname\space\@supervisorDsLastname
    \fi
    \ifx\@supervisorEsLastname\@empty
    \else
    , \@supervisorEsFirstname\space\@supervisorEsLastname
    \fi
    \par
    Examinator: \@examinersFirstname\space\@examinersLastname\par
    \quad\@examinersSchool\par
    \ifx\@hostcompany\@empty\relax\else Uppdragsgivare: \@hostcompany \par \fi
    \ifx\@hostorganization\@empty\relax\else Uppdragsgivare: \@hostorganization \par \fi
    \ifx\@alttitle\empty\relax\else Engelsk titel: %
    \begin{otherlanguage}{english}\sffamily\@alttitle\end{otherlanguage} \fi
    \ifx\@altsubtitle\@empty\relax
    \else
    English subtitle \begin{otherlanguage}{english}\sffamily\@altsubtitle\end{otherlanguage} \\
    \fi
  \else
    \@prgmcode\par
    \ifx\@prgmcode och \@secondprgmcode \par  \fi   % for a second program
    \ifx\@date\@empty\relax\else Date: \@date\\ \vspace{5mm} \fi
    \ifx\@supervisorBsLastname\@empty
    Supervisor: \@supervisorAsFirstname\space\@supervisorAsLastname
    \else
    Supervisors: \@supervisorAsFirstname\space\@supervisorAsLastname,  \@supervisorBsFirstname\space\@supervisorBsLastname
    \fi
    \ifx\@supervisorCsLastname\@empty
    \else
    , \@supervisorCsFirstname\space\@supervisorCsLastname
    \fi
    \ifx\@supervisorDsLastname\@empty
    \else
    , \@supervisorDsFirstname\space\@supervisorDsLastname
    \fi
    \ifx\@supervisorEsLastname\@empty
    \else
    , \@supervisorEsFirstname\space\@supervisorEsLastname
    \fi
    \par
    Examiner: \@examinersFirstname\space\@examinersLastname\par
    \quad\@examinersSchool\par
    \ifx\@hostcompany\@empty\relax\else Host company: \@hostcompany \par \fi
    \ifx\@hostorganization\@empty\relax\else Host organization: \@hostorganization \par \fi
    \ifx\@alttitle\empty\relax\else Swedish title: %
        \begin{otherlanguage}{swedish}
        \sffamily\@alttitle\end{otherlanguage}
        \par \fi
    \ifx\@altsubtitle\@empty\relax\else {\sffamily 
    Swedish subtitle:} %
        \begin{otherlanguage}{swedish}
        \sffamily\@altsubtitle\end{otherlanguage} \par \fi
  \fi
\end{flushleft}
\restoregeometry
\clearpage
}

% Command to print out the standardized document information page
\newcommand{\bookinfopage}{
\iftoggle{gfivepaper}{
  \newgeometry{top=140mm,bottom=30mm,left=12.25mm,right=35mm}
}{
  \newgeometry{top=250mm,bottom=30mm,left=74pt,right=35mm}
}
\thispagestyle{empty}
\begin{flushleft}
  \sffamily
  \copyright\enspace\the\year\quad\@authorsFirstname\space\@authorsLastname 
  \ifx\@secondAuthorsLastname\@empty\relax
  \else
    \ifinswedish
      \enspace och\enspace\@secondAuthorsFirstname\space\@secondAuthorsLastname \\
    \else
      \enspace and\enspace\@secondAuthorsFirstname\space\@secondAuthorsLastname \\
    \fi
  \fi
    \vspace{1ex}
    \ifx\@coverIllustrationCredit\@empty\relax
    \else
    \ifinswedish
    Omslagsillustration:\ 
    \else
    Cover illustration:\ 
    \fi
    \@coverIllustrationCredit\\
    \vspace{1ex}
    \fi
\end{flushleft}
\thesiscopyrightleft{copyright}
% make the following code conditional upon the package hyperxmp being used
\ltx@ifpackageloaded{hyperxmp}{
\newcommand{\mycopyright}{%
  {Copyright (c)}\ \the\year\ \@authorsFirstname\ \@authorsLastname %
  \ifx\@secondAuthorsLastname\@empty\relax%
  \else%
    \ifinswedish%
      \  och\ \@secondAuthorsFirstname\ \@secondAuthorsLastname%
    \else%
      \  and\ \@secondAuthorsFirstname\ \@secondAuthorsLastname%
    \fi%
  \fi%
}
\hypersetup{
     pdfcopyright={\mycopyright} 
}
}{}% end of ifpackage conditional
\restoregeometry
\clearpage
}

% bookinfo page with CC license
% CC BY (Attribution)
% CC BY-NC (Attribution + Non-commercial)
% CC BY-ND (Attribution + No derivatives)
% CC BY-NC-ND (Attribution + Non-commercial + No derivatives)
% CC BY-SA (Attribution + ShareAlike)
% CC BY-NC-SA (Attribution + Non-commercial + ShareAlike)
% CC0 (Zero)
\newcommand{\bookinfopageCC}{
\iftoggle{gfivepaper}{
  \newgeometry{top=130mm,bottom=30mm,left=12.25mm,right=35mm}
}{
  \newgeometry{top=220mm,bottom=30mm,left=74pt,right=35mm}
}
\thispagestyle{empty}
\begin{flushleft}
  \sffamily
  \IfEqCase{\doclicense@modifier}{%
    {by}{CC BY}%
    {by-nc}{CC BY-NC}%
    {by-nd}{CC BY-ND}%
    {by-nc-nd}{CC BY-NC-ND}%
    {by-sa}{CC BY-SA}%
    {by-nc-sa}{CC BY-NC-SA}%
    {zero}{CC0}%
  }[\typeout{Creative Commons code  \doclicense@modifier not found}\copyright]
  \enspace\the\year\quad\@authorsFirstname\space\@authorsLastname 
  \ifx\@secondAuthorsLastname\@empty\relax
  \else
    \ifinswedish
      \enspace och\enspace\@secondAuthorsFirstname\space\@secondAuthorsLastname \\
    \else
      \enspace and\enspace\@secondAuthorsFirstname\space\@secondAuthorsLastname \\
    \fi
  \fi
  \doclicenseThis
\end{flushleft}
\thesiscopyrightleft{\doclicense@modifier}
% make the following code conditional upon the package hyperxmp being used
\ltx@ifpackageloaded{hyperxmp}{
\let\@myCC\@empty
\ifdefstring{\doclicense@modifier}{by}{\def\@myCC{CC BY}}{}
\ifdefstring{\doclicense@modifier}{by-nc}{\def\@myCC{CC BY-NC}}{}
\ifdefstring{\doclicense@modifier}{by-nd}{\def\@myCC{CC BY-ND}}{}
\ifdefstring{\doclicense@modifier}{by-nc-nd}{\def\@myCC{CC BY-NC-ND}}{}
\ifdefstring{\doclicense@modifier}{by-sa}{\def\@myCC{CC BY-SA}}{}
\ifdefstring{\doclicense@modifier}{by-nc-sa}{\def\@myCC{CC BY-NC-SA}}{}
\ifdefstring{\doclicense@modifier}{zero}{\def\@myCC{CC0}}{}

\newcommand{\mycopyright}{%
 \@myCC\ \the\year\ \@authorsFirstname\ \@authorsLastname%
  \ifx\@secondAuthorsLastname\@empty\relax%
  \else%
    \ifinswedish%
      \  och\ \@secondAuthorsFirstname\ \@secondAuthorsLastname%
    \else%
      \ and\ \@secondAuthorsFirstname\ \@secondAuthorsLastname %
    \fi%
  \fi%
}

\hypersetup{
     pdfcopyright={\mycopyright} 
}
}{}% end of ifpackage conditional
\restoregeometry
\clearpage
}

% If the doclicense package is installed, then use the \bookinfoCC when encountering a \bookinfo command
\AtBeginDocument{\@ifpackageloaded{doclicense}
  {%
    \renewcommand{\bookinfopage}{\bookinfopageCC}
  }
  {\relax}
}

\newcommand{\acknowlegmentssignature}{
 \ifx\@secondAuthorsLastname\@empty
 \begin{flushleft}
\@authorCityCountryDate\\
    \@authorsFirstname\space\@authorsLastname
 \end{flushleft}
\else
\begin{flushleft}
\begin{tabular}{l l}
\@authorCityCountryDate & \@secondAuthorCityCountryDate \\
    \@authorsFirstname\space\@authorsLastname &
    \@secondAuthorsFirstname\space\@secondAuthorsLastname \\
%       \ifinswedish
%       \enspace & \enspace\@secondAuthorsFirstname\space\@secondAuthorsLastname \\
%       \else
%       \enspace and\enspace\@secondAuthorsFirstname\space\@secondAuthorsLastname \\
%       \fi
\end{tabular}
\end{flushleft}
\fi

\cleardoublepage
}

\newcommand{\frontmatter}{
  \pagenumbering{roman}
  % when using backref with hyperref one cannot manually reset the page numbers, but needs to use different numbering schemes - see https://tex.stackexchange.com/questions/93889/why-does-backref-refer-to-wrong-page
%  \setcounter{page}{1}
}

\newcommand{\mainmatter}{
  \cleardoublepage
  \pagenumbering{arabic}
}
\makeatother
